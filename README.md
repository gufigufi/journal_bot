# Telegram-–±–æ—Ç —Å–ø–æ–≤—ñ—â–µ–Ω—å –ø—Ä–æ –æ—Ü—ñ–Ω–∫–∏ –∑ Google Sheets

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏—Ö —Å–ø–æ–≤—ñ—â–µ–Ω—å –ø—Ä–æ –∑–º—ñ–Ω–∏ –æ—Ü—ñ–Ω–æ–∫ —É Google Sheets —á–µ—Ä–µ–∑ Telegram –±–æ—Ç–∞.

## –û—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ

- üîî –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω—ñ push-—Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è –ø—Ä–∏ –∑–º—ñ–Ω—ñ –æ—Ü—ñ–Ω–æ–∫
- üë®‚Äçüéì –ü—ñ–¥—Ç—Ä–∏–º–∫–∞ —Ç—Ä—å–æ—Ö —Ä–æ–ª–µ–π: —Å—Ç—É–¥–µ–Ω—Ç, –±–∞—Ç—å–∫–æ, –º–∞—Ç–∏
- üìä –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –∑ Google Sheets
- üîí –°—Ç—Ä–æ–≥–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—è –∑–∞ –ü–Ü–ë
- üíæ SQLite –±–∞–∑–∞ –¥–∞–Ω–∏—Ö
- üá∫üá¶ –£–∫—Ä–∞—ó–Ω—Å—å–∫–∏–π —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ—î–∫—Ç—É

```
.
‚îú‚îÄ‚îÄ main.py              # –ì–æ–ª–æ–≤–Ω–∏–π —Ñ–∞–π–ª –∑–∞–ø—É—Å–∫—É
‚îú‚îÄ‚îÄ bot.py               # Telegram –±–æ—Ç –∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—î—é
‚îú‚îÄ‚îÄ database.py          # –†–æ–±–æ—Ç–∞ –∑ –ë–î SQLite
‚îú‚îÄ‚îÄ notifications.py     # –õ–æ–≥—ñ–∫–∞ —Ä–æ–∑—Å–∏–ª–∫–∏ —Å–ø–æ–≤—ñ—â–µ–Ω—å
‚îú‚îÄ‚îÄ webhook.py           # Webhook endpoint –¥–ª—è Google Apps Script
‚îú‚îÄ‚îÄ schema.sql           # SQL —Å—Ö–µ–º–∞ –ë–î
‚îú‚îÄ‚îÄ gas_script.gs        # Google Apps Script –¥–ª—è –≤—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è –∑–º—ñ–Ω
‚îú‚îÄ‚îÄ requirements.txt     # Python –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ
‚îú‚îÄ‚îÄ .env.example         # –ü—Ä–∏–∫–ª–∞–¥ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó
‚îî‚îÄ‚îÄ README.md            # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è
```

## –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è

### 1. –ö–ª–æ–Ω—É–≤–∞–Ω–Ω—è —Ç–∞ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π

```bash
git clone <repository-url>
cd <project-directory>
python -m venv venv
source venv/bin/activate  # –ù–∞ Windows: venv\Scripts\activate
pip install -r requirements.txt
```

### 2. –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó

–°—Ç–≤–æ—Ä—ñ—Ç—å —Ñ–∞–π–ª `.env` –Ω–∞ –æ—Å–Ω–æ–≤—ñ `.env.example`:

```bash
cp .env.example .env
```

–í—ñ–¥—Ä–µ–¥–∞–≥—É–π—Ç–µ `.env`:

```env
TELEGRAM_BOT_TOKEN=your_bot_token_from_botfather
PUBLIC_BASE_URL=https://your-server.com
APPS_SCRIPT_WEBHOOK_SECRET=your_random_secret_string
DATABASE_PATH=./data/grades.db
WEBHOOK_PORT=8080
```

### 3. –°—Ç–≤–æ—Ä–µ–Ω–Ω—è Telegram –±–æ—Ç–∞

1. –ó–Ω–∞–π–¥—ñ—Ç—å [@BotFather](https://t.me/botfather) —É Telegram
2. –í—ñ–¥–ø—Ä–∞–≤—Ç–µ `/newbot`
3. –î–∞–π—Ç–µ –Ω–∞–∑–≤—É –±–æ—Ç—É
4. –°–∫–æ–ø—ñ—é–π—Ç–µ —Ç–æ–∫–µ–Ω —É `.env`

### 4. –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –±–∞–∑–∏ –¥–∞–Ω–∏—Ö

–ë–∞–∑–∞ –¥–∞–Ω–∏—Ö —Å—Ç–≤–æ—Ä—é—î—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø—Ä–∏ –ø–µ—Ä—à–æ–º—É –∑–∞–ø—É—Å–∫—É. –î–ª—è –¥–æ–¥–∞–≤–∞–Ω–Ω—è –≥—Ä—É–ø —Ç–∞ —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ Python:

```python
import asyncio
from database import Database

async def init_data():
    db = Database('./data/grades.db')
    await db.init_db()
    
    # –î–æ–¥–∞—Ç–∏ –≥—Ä—É–ø—É
    group_id = await db.add_group(
        name="–Ü–ü-21",
        spreadsheet_id="your_google_spreadsheet_id"
    )
    
    # –î–æ–¥–∞—Ç–∏ —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤
    await db.add_student("–Ü–≤–∞–Ω–æ–≤ –Ü–≤–∞–Ω –Ü–≤–∞–Ω–æ–≤–∏—á", group_id)
    await db.add_student("–ü–µ—Ç—Ä–µ–Ω–∫–æ –ü–µ—Ç—Ä–æ –ü–µ—Ç—Ä–æ–≤–∏—á", group_id)

asyncio.run(init_data())
```

### 5. –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è Google Apps Script

1. –í—ñ–¥–∫—Ä–∏–π—Ç–µ –≤–∞—à Google Spreadsheet
2. –ü–µ—Ä–µ–π–¥—ñ—Ç—å —É **–†–æ–∑—à–∏—Ä–µ–Ω–Ω—è ‚Üí Apps Script**
3. –°–∫–æ–ø—ñ—é–π—Ç–µ –≤–º—ñ—Å—Ç —Ñ–∞–π–ª—É `gas_script.gs`
4. –ó–∞–º—ñ–Ω—ñ—Ç—å –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∏:
   - `WEBHOOK_URL` - –≤–∞—à –ø—É–±–ª—ñ—á–Ω–∏–π URL + `/webhook/grades`
   - `WEBHOOK_SECRET` - —Ç–æ–π —Å–∞–º–∏–π —Å–µ–∫—Ä–µ—Ç –∑ `.env`
5. –ó–±–µ—Ä–µ–∂—ñ—Ç—å –ø—Ä–æ—î–∫—Ç
6. –¢—Ä–∏–≥–µ—Ä —Å—Ç–≤–æ—Ä—é—î—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø—Ä–∏ —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—ñ

### 6. –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞

```bash
python main.py
```

–ë–æ—Ç –∑–∞–ø—É—Å—Ç–∏—Ç—å—Å—è —ñ –±—É–¥–µ —Å–ª—É—Ö–∞—Ç–∏:
- Telegram –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è (long polling)
- Webhook –Ω–∞ –ø–æ—Ä—Ç—É 8080

## –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è

### –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤

1. –ó–Ω–∞–π–¥—ñ—Ç—å –±–æ—Ç–∞ —É Telegram
2. –í—ñ–¥–ø—Ä–∞–≤—Ç–µ `/start`
3. –û–±–µ—Ä—ñ—Ç—å —Ä–æ–ª—å (—Å—Ç—É–¥–µ–Ω—Ç/–±–∞—Ç—å–∫–æ/–º–∞—Ç–∏)
4. –û–±–µ—Ä—ñ—Ç—å –≥—Ä—É–ø—É –∑—ñ —Å–ø–∏—Å–∫—É
5. –í–≤–µ–¥—ñ—Ç—å –ü–Ü–ë **—Ç–æ—á–Ω–æ** —è–∫ —É –∂—É—Ä–Ω–∞–ª—ñ

### –§–æ—Ä–º–∞—Ç Google Sheets

**–õ–∏—Å—Ç 1 (–°–ø–∏—Å–æ–∫ –≥—Ä—É–ø–∏):**
- –ï—Ç–∞–ª–æ–Ω–Ω–∏–π —Å–ø–∏—Å–æ–∫ —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤ –∑ –ø–æ–≤–Ω–∏–º–∏ –ü–Ü–ë

**–õ–∏—Å—Ç–∏ 2..N (–ü—Ä–µ–¥–º–µ—Ç–∏):**
- **A1**: –ù–∞–∑–≤–∞ –ø—Ä–µ–¥–º–µ—Ç—É
- **C2:C**: –ü–Ü–ë —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤
- **–†—è–¥–æ–∫ 2 (D‚Üí)**: –¢–∏–ø –∑–∞–Ω—è—Ç—Ç—è (–õ–µ–∫—Ü—ñ—è, –ü—Ä–∞–∫—Ç–∏–∫–∞, —Ç–æ—â–æ)
- **–†—è–¥–æ–∫ 3 (D‚Üí)**: –î–∞—Ç–∞ –∑–∞–Ω—è—Ç—Ç—è
- **D4:**: –û—Ü—ñ–Ω–∫–∏ (–ø–µ—Ä–µ—Ç–∏–Ω —Å—Ç—É–¥–µ–Ω—Ç–∞ —ñ –∑–∞–Ω—è—Ç—Ç—è)

### –ü—Ä–∏–∫–ª–∞–¥ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è

```
–ü—Ä–µ–¥–º–µ—Ç: –ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞
–î–∞—Ç–∞: 12.09.2025
–¢–∏–ø: –õ–µ–∫—Ü—ñ—è
–ë—É–ª–æ: –ù–ë ‚Üí –°—Ç–∞–ª–æ: 10
```

## –†–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ñ

### Docker (—Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ)

–°—Ç–≤–æ—Ä—ñ—Ç—å `Dockerfile`:

```dockerfile
FROM python:3.11-slim

WORKDIR /app

COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

COPY . .

CMD ["python", "main.py"]
```

–ó–∞–ø—É—Å–∫:

```bash
docker build -t grades-bot .
docker run -d --name grades-bot \
  --env-file .env \
  -p 8080:8080 \
  -v $(pwd)/data:/app/data \
  grades-bot
```

### Systemd Service

–°—Ç–≤–æ—Ä—ñ—Ç—å `/etc/systemd/system/grades-bot.service`:

```ini
[Unit]
Description=Grades Notification Bot
After=network.target

[Service]
Type=simple
User=your-user
WorkingDirectory=/path/to/project
Environment="PATH=/path/to/project/venv/bin"
ExecStart=/path/to/project/venv/bin/python main.py
Restart=always

[Install]
WantedBy=multi-user.target
```

–ó–∞–ø—É—Å–∫:

```bash
sudo systemctl daemon-reload
sudo systemctl enable grades-bot
sudo systemctl start grades-bot
```

### Nginx (–¥–ª—è webhook)

```nginx
server {
    listen 80;
    server_name your-domain.com;

    location /webhook/ {
        proxy_pass http://localhost:8080;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}
```

## –ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä—É–≤–∞–Ω–Ω—è

### –î–æ–¥–∞–≤–∞–Ω–Ω—è –Ω–æ–≤–æ—ó –≥—Ä—É–ø–∏

```python
await db.add_group("–Ü–ü-22", "spreadsheet_id_here")
```

### –î–æ–¥–∞–≤–∞–Ω–Ω—è —Å—Ç—É–¥–µ–Ω—Ç–∞

```python
await db.add_student("–°–∏–¥–æ—Ä–µ–Ω–∫–æ –°–∏–¥—ñ—Ä –°–∏–¥–æ—Ä–æ–≤–∏—á", group_id)
```

### –ü–µ—Ä–µ–≥–ª—è–¥ –ª–æ–≥—ñ–≤

```bash
# –Ø–∫—â–æ –∑–∞–ø—É—â–µ–Ω–æ —á–µ—Ä–µ–∑ systemd
sudo journalctl -u grades-bot -f

# –Ø–∫—â–æ –∑–∞–ø—É—â–µ–Ω–æ —á–µ—Ä–µ–∑ Docker
docker logs -f grades-bot
```

### –†–µ–∑–µ—Ä–≤–Ω–µ –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è –ë–î

```bash
cp ./data/grades.db ./data/grades.db.backup
```

## –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è

### –¢–µ—Å—Ç webhook –∑ Google Apps Script

–£ —Ä–µ–¥–∞–∫—Ç–æ—Ä—ñ Apps Script –≤–∏–∫–æ–Ω–∞–π—Ç–µ —Ñ—É–Ω–∫—Ü—ñ—é `testWebhook()`:

1. –û–±–µ—Ä—ñ—Ç—å —Ñ—É–Ω–∫—Ü—ñ—é `testWebhook`
2. –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å "–í–∏–∫–æ–Ω–∞—Ç–∏"
3. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ª–æ–≥–∏

### –¢–µ—Å—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó

1. –ó–∞–ø—É—Å—Ç—ñ—Ç—å –±–æ—Ç–∞
2. –í—ñ–¥–ø—Ä–∞–≤—Ç–µ `/start`
3. –ü—Ä–æ–π–¥—ñ—Ç—å –ø—Ä–æ—Ü–µ—Å —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó

## –ö—Ä–∞–π–æ–≤—ñ –≤–∏–ø–∞–¥–∫–∏

- **–ü–Ü–ë –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ**: –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —Ç–æ—á–Ω—ñ—Å—Ç—å –Ω–∞–ø–∏—Å–∞–Ω–Ω—è
- **–†–æ–ª—å –∑–∞–π–Ω—è—Ç–∞**: –ó–≤–µ—Ä–Ω—ñ—Ç—å—Å—è –¥–æ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –¥–ª—è —Å–∫–∏–¥–∞–Ω–Ω—è
- **Webhook –Ω–µ –ø—Ä–∞—Ü—é—î**: –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ URL —Ç–∞ —Å–µ–∫—Ä–µ—Ç —É Apps Script
- **–°—Ç—É–¥–µ–Ω—Ç —É –¥–≤–æ—Ö –≥—Ä—É–ø–∞—Ö**: –°–∏—Å—Ç–µ–º–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î –≥—Ä—É–ø—É –∑ –ë–î

## –ë–µ–∑–ø–µ–∫–∞

- ‚úÖ Webhook –∑–∞—Ö–∏—â–µ–Ω–∏–π —Å–µ–∫—Ä–µ—Ç–Ω–∏–º —Ç–æ–∫–µ–Ω–æ–º
- ‚úÖ –°—Ç—Ä–æ–≥–∞ –≤–∞–ª—ñ–¥–∞—Ü—ñ—è –ü–Ü–ë
- ‚úÖ –ù–µ–º–∞—î –ø—É–±–ª—ñ—á–Ω–æ–≥–æ API
- ‚úÖ –õ–æ–≥—É–≤–∞–Ω–Ω—è –≤—Å—ñ—Ö –ø–æ–¥—ñ–π

## –õ—ñ—Ü–µ–Ω–∑—ñ—è

MIT

## –ü—ñ–¥—Ç—Ä–∏–º–∫–∞

–î–ª—è –ø–∏—Ç–∞–Ω—å —Ç–∞ –ø—Ä–æ–±–ª–µ–º —Å—Ç–≤–æ—Ä—ñ—Ç—å issue —É —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó.
