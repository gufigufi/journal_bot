# Telegram-–±–æ—Ç —Å–ø–æ–≤—ñ—â–µ–Ω—å –ø—Ä–æ –æ—Ü—ñ–Ω–∫–∏ –∑ Google Sheets

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏—Ö —Å–ø–æ–≤—ñ—â–µ–Ω—å –ø—Ä–æ –∑–º—ñ–Ω–∏ –æ—Ü—ñ–Ω–æ–∫ —É Google Sheets —á–µ—Ä–µ–∑ Telegram –±–æ—Ç–∞ –∑ –≤–µ–±-—ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º –¥–ª—è –ø–µ—Ä–µ–≥–ª—è–¥—É –æ—Ü—ñ–Ω–æ–∫.

## –û—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ

- üîî –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω—ñ push-—Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è –ø—Ä–∏ –∑–º—ñ–Ω—ñ –æ—Ü—ñ–Ω–æ–∫
- üë®‚Äçüéì –ü—ñ–¥—Ç—Ä–∏–º–∫–∞ —Ç—Ä—å–æ—Ö —Ä–æ–ª–µ–π: —Å—Ç—É–¥–µ–Ω—Ç, –±–∞—Ç—å–∫–æ, –º–∞—Ç–∏
- üìä –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –∑ Google Sheets
- üåê –í–µ–±-—ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –ø–µ—Ä–µ–≥–ª—è–¥—É –æ—Ü—ñ–Ω–æ–∫
- üîí –°—Ç—Ä–æ–≥–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—è –∑–∞ –ü–Ü–ë
- üíæ SQLite –±–∞–∑–∞ –¥–∞–Ω–∏—Ö
- üá∫üá¶ –£–∫—Ä–∞—ó–Ω—Å—å–∫–∏–π —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å
- üê≥ Docker –ø—ñ–¥—Ç—Ä–∏–º–∫–∞

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ—î–∫—Ç—É

```
.
‚îú‚îÄ‚îÄ main.py              # –ì–æ–ª–æ–≤–Ω–∏–π —Ñ–∞–π–ª –∑–∞–ø—É—Å–∫—É
‚îú‚îÄ‚îÄ bot.py               # Telegram –±–æ—Ç –∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—î—é
‚îú‚îÄ‚îÄ database.py          # –†–æ–±–æ—Ç–∞ –∑ –ë–î SQLite
‚îú‚îÄ‚îÄ notifications.py     # –õ–æ–≥—ñ–∫–∞ —Ä–æ–∑—Å–∏–ª–∫–∏ —Å–ø–æ–≤—ñ—â–µ–Ω—å
‚îú‚îÄ‚îÄ webhook.py           # Webhook endpoint –¥–ª—è Google Apps Script
‚îú‚îÄ‚îÄ web_app.py           # –í–µ–±-–¥–æ–¥–∞—Ç–æ–∫ –¥–ª—è –ø–µ—Ä–µ–≥–ª—è–¥—É –æ—Ü—ñ–Ω–æ–∫
‚îú‚îÄ‚îÄ google_sheets.py     # –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –∑ Google Sheets API
‚îú‚îÄ‚îÄ init_data.py         # –°–∫—Ä–∏–ø—Ç –¥–ª—è —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó —Ç–µ—Å—Ç–æ–≤–∏—Ö –¥–∞–Ω–∏—Ö
‚îú‚îÄ‚îÄ schema.sql           # SQL —Å—Ö–µ–º–∞ –ë–î
‚îú‚îÄ‚îÄ gas_script.gs        # Google Apps Script –¥–ª—è –≤—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è –∑–º—ñ–Ω
‚îú‚îÄ‚îÄ requirements.txt     # Python –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ
‚îú‚îÄ‚îÄ Dockerfile           # Docker –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è
‚îú‚îÄ‚îÄ docker-compose.yml   # Docker Compose –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è
‚îú‚îÄ‚îÄ .env.example         # –ü—Ä–∏–∫–ª–∞–¥ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó
‚îú‚îÄ‚îÄ templates/           # HTML —à–∞–±–ª–æ–Ω–∏ –¥–ª—è –≤–µ–±-–¥–æ–¥–∞—Ç–∫—É
‚îÇ   ‚îú‚îÄ‚îÄ login.html
‚îÇ   ‚îú‚îÄ‚îÄ dashboard.html
‚îÇ   ‚îî‚îÄ‚îÄ grades.html
‚îú‚îÄ‚îÄ static/              # –°—Ç–∞—Ç–∏—á–Ω—ñ —Ñ–∞–π–ª–∏ (CSS, JS)
‚îî‚îÄ‚îÄ data/                # –î–∏—Ä–µ–∫—Ç–æ—Ä—ñ—è –¥–ª—è –±–∞–∑–∏ –¥–∞–Ω–∏—Ö
```

## –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è

### –í–∞—Ä—ñ–∞–Ω—Ç 1: –õ–æ–∫–∞–ª—å–Ω–∏–π –∑–∞–ø—É—Å–∫

#### 1. –ö–ª–æ–Ω—É–≤–∞–Ω–Ω—è —Ç–∞ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π

```bash
git clone <repository-url>
cd <project-directory>
python -m venv venv
source venv/bin/activate  # –ù–∞ Windows: venv\Scripts\activate
pip install -r requirements.txt
```

#### 2. –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó

–°—Ç–≤–æ—Ä—ñ—Ç—å —Ñ–∞–π–ª `.env`:

```bash
cp .env.example .env
```

–í—ñ–¥—Ä–µ–¥–∞–≥—É–π—Ç–µ `.env`:

```env
TELEGRAM_BOT_TOKEN=your_bot_token_here
PUBLIC_BASE_URL=https://your-server.com
APPS_SCRIPT_WEBHOOK_SECRET=your_secret_here
DATABASE_PATH=./data/grades.db
WEBHOOK_PORT=8080
WEB_PORT=8081
WEB_SECRET_KEY=your_random_secret_key_here
GOOGLE_CREDENTIALS_PATH=./credentials.json
```

**–û–ø–∏—Å –∑–º—ñ–Ω–Ω–∏—Ö:**
- `TELEGRAM_BOT_TOKEN` - —Ç–æ–∫–µ–Ω –±–æ—Ç–∞ –≤—ñ–¥ @BotFather
- `PUBLIC_BASE_URL` - –ø—É–±–ª—ñ—á–Ω–∏–π URL –≤–∞—à–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞ (–¥–ª—è webhook)
- `APPS_SCRIPT_WEBHOOK_SECRET` - —Å–µ–∫—Ä–µ—Ç–Ω–∏–π –∫–ª—é—á –¥–ª—è –∑–∞—Ö–∏—Å—Ç—É webhook
- `DATABASE_PATH` - —à–ª—è—Ö –¥–æ —Ñ–∞–π–ª—É –±–∞–∑–∏ –¥–∞–Ω–∏—Ö
- `WEBHOOK_PORT` - –ø–æ—Ä—Ç –¥–ª—è webhook —Å–µ—Ä–≤–µ—Ä–∞ (–∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º 8080)
- `WEB_PORT` - –ø–æ—Ä—Ç –¥–ª—è –≤–µ–±-–¥–æ–¥–∞—Ç–∫—É (–∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º 8081)
- `WEB_SECRET_KEY` - —Å–µ–∫—Ä–µ—Ç–Ω–∏–π –∫–ª—é—á –¥–ª—è —à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è —Å–µ—Å—ñ–π –≤–µ–±-–¥–æ–¥–∞—Ç–∫—É
- `GOOGLE_CREDENTIALS_PATH` - —à–ª—è—Ö –¥–æ —Ñ–∞–π–ª—É credentials.json –≤—ñ–¥ Google

#### 3. –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è Google Sheets API

1. –ü–µ—Ä–µ–π–¥—ñ—Ç—å –¥–æ [Google Cloud Console](https://console.cloud.google.com/)
2. –°—Ç–≤–æ—Ä—ñ—Ç—å –Ω–æ–≤–∏–π –ø—Ä–æ–µ–∫—Ç –∞–±–æ –≤–∏–±–µ—Ä—ñ—Ç—å —ñ—Å–Ω—É—é—á–∏–π
3. –£–≤—ñ–º–∫–Ω—ñ—Ç—å Google Sheets API
4. –°—Ç–≤–æ—Ä—ñ—Ç—å Service Account
5. –ó–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ JSON –∫–ª—é—á —ñ –∑–±–µ—Ä–µ–∂—ñ—Ç—å —è–∫ `credentials.json`
6. –ù–∞–¥–∞–π—Ç–µ –¥–æ—Å—Ç—É–ø Service Account –¥–æ –≤–∞—à–æ—ó —Ç–∞–±–ª–∏—Ü—ñ Google Sheets

#### 4. –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—ó –¥–ª—è –¥–∞–Ω–∏—Ö

```bash
mkdir -p data
```

#### 5. –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –±–∞–∑–∏ –¥–∞–Ω–∏—Ö (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ)

–î–ª—è –¥–æ–¥–∞–≤–∞–Ω–Ω—è —Ç–µ—Å—Ç–æ–≤–∏—Ö –¥–∞–Ω–∏—Ö:

```bash
python init_data.py
```

#### 6. –ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç—É

```bash
python main.py
```

–ü—ñ—Å–ª—è –∑–∞–ø—É—Å–∫—É –±—É–¥—É—Ç—å –¥–æ—Å—Ç—É–ø–Ω—ñ:
- **Webhook —Å–µ—Ä–≤–µ—Ä**: `http://localhost:8080`
- **–í–µ–±-–¥–æ–¥–∞—Ç–æ–∫**: `http://localhost:8081`
- **Telegram –±–æ—Ç**: –ø—Ä–∞—Ü—é—î –≤ —Ä–µ–∂–∏–º—ñ polling

### –í–∞—Ä—ñ–∞–Ω—Ç 2: –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ Docker

#### 1. –ü—ñ–¥–≥–æ—Ç–æ–≤–∫–∞

–°—Ç–≤–æ—Ä—ñ—Ç—å —Ñ–∞–π–ª `.env` —è–∫ –æ–ø–∏—Å–∞–Ω–æ –≤–∏—â–µ —Ç–∞ –ø–æ–º—ñ—Å—Ç—ñ—Ç—å `credentials.json` –≤ –∫–æ—Ä—ñ–Ω—å –ø—Ä–æ–µ–∫—Ç—É.

#### 2. –ó–±—ñ—Ä–∫–∞ —Ç–∞ –∑–∞–ø—É—Å–∫

```bash
docker-compose up -d
```

#### 3. –ü–µ—Ä–µ–≥–ª—è–¥ –ª–æ–≥—ñ–≤

```bash
docker-compose logs -f
```

#### 4. –ó—É–ø–∏–Ω–∫–∞

```bash
docker-compose down
```

## –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è Google Apps Script

1. –í—ñ–¥–∫—Ä–∏–π—Ç–µ –≤–∞—à—É Google Sheets —Ç–∞–±–ª–∏—Ü—é
2. –ü–µ—Ä–µ–π–¥—ñ—Ç—å –¥–æ **–†–æ–∑—à–∏—Ä–µ–Ω–Ω—è** ‚Üí **Apps Script**
3. –°–∫–æ–ø—ñ—é–π—Ç–µ –≤–º—ñ—Å—Ç —Ñ–∞–π–ª—É `gas_script.gs`
4. –ó–∞–º—ñ–Ω—ñ—Ç—å `WEBHOOK_URL` –Ω–∞ –≤–∞—à –ø—É–±–ª—ñ—á–Ω–∏–π URL + `/webhook`
5. –ó–∞–º—ñ–Ω—ñ—Ç—å `SECRET` –Ω–∞ –∑–Ω–∞—á–µ–Ω–Ω—è –∑ `.env` (`APPS_SCRIPT_WEBHOOK_SECRET`)
6. –ó–±–µ—Ä–µ–∂—ñ—Ç—å —Ç–∞ –≤—Å—Ç–∞–Ω–æ–≤—ñ—Ç—å —Ç—Ä–∏–≥–µ—Ä –Ω–∞ `onChange`

## –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è

### Telegram –±–æ—Ç

1. –ó–Ω–∞–π–¥—ñ—Ç—å –≤–∞—à–æ–≥–æ –±–æ—Ç–∞ –≤ Telegram
2. –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å `/start`
3. –í–≤–µ–¥—ñ—Ç—å –≤–∞—à–µ –ü–Ü–ë (–ø–æ–≤–Ω—ñ—Å—Ç—é, —è–∫ –≤ —Ç–∞–±–ª–∏—Ü—ñ)
4. –í–∏–±–µ—Ä—ñ—Ç—å —Ä–æ–ª—å (—Å—Ç—É–¥–µ–Ω—Ç/–±–∞—Ç—å–∫–æ/–º–∞—Ç–∏)
5. –û—Ç—Ä–∏–º—É–π—Ç–µ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è –ø—Ä–æ –∑–º—ñ–Ω–∏ –æ—Ü—ñ–Ω–æ–∫

### –í–µ–±-–¥–æ–¥–∞—Ç–æ–∫

1. –í—ñ–¥–∫—Ä–∏–π—Ç–µ `http://localhost:8081` (–∞–±–æ –≤–∞—à –ø—É–±–ª—ñ—á–Ω–∏–π URL)
2. –£–≤—ñ–π–¥—ñ—Ç—å –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ –ü–Ü–ë —Å—Ç—É–¥–µ–Ω—Ç–∞
3. –ü–µ—Ä–µ–≥–ª—è–¥–∞–π—Ç–µ –æ—Ü—ñ–Ω–∫–∏ –≤ –∑—Ä—É—á–Ω–æ–º—É —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ñ

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö

–ë–∞–∑–∞ –¥–∞–Ω–∏—Ö SQLite –º—ñ—Å—Ç–∏—Ç—å –Ω–∞—Å—Ç—É–ø–Ω—ñ —Ç–∞–±–ª–∏—Ü—ñ:
- `groups` - –≥—Ä—É–ø–∏ —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤
- `students` - —Å—Ç—É–¥–µ–Ω—Ç–∏
- `users` - –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ Telegram
- `grades` - –æ—Ü—ñ–Ω–∫–∏
- `grade_history` - —ñ—Å—Ç–æ—Ä—ñ—è –∑–º—ñ–Ω –æ—Ü—ñ–Ω–æ–∫

–°—Ö–µ–º–∞ –ë–î –∑–Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –≤ —Ñ–∞–π–ª—ñ `schema.sql`.

## –†–æ–∑—Ä–æ–±–∫–∞

### –í–∏–º–æ–≥–∏

- Python 3.11+
- SQLite 3
- Google Cloud Project –∑ —É–≤—ñ–º–∫–Ω–µ–Ω–∏–º Sheets API

### –ó–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ

–û—Å–Ω–æ–≤–Ω—ñ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ:
- `aiogram` - Telegram Bot API
- `aiohttp` - –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∏–π HTTP —Å–µ—Ä–≤–µ—Ä
- `aiosqlite` - –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞ —Ä–æ–±–æ—Ç–∞ –∑ SQLite
- `google-api-python-client` - Google Sheets API
- `jinja2` - —à–∞–±–ª–æ–Ω—ñ–∑–∞—Ç–æ—Ä –¥–ª—è –≤–µ–±-–¥–æ–¥–∞—Ç–∫—É
- `python-dotenv` - —Ä–æ–±–æ—Ç–∞ –∑—ñ –∑–º—ñ–Ω–Ω–∏–º–∏ –æ—Ç–æ—á–µ–Ω–Ω—è

### –õ–æ–≥—É–≤–∞–Ω–Ω—è

–í—Å—ñ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏–π –º–æ–¥—É–ª—å `logging` Python. –õ–æ–≥–∏ –≤–∏–≤–æ–¥—è—Ç—å—Å—è –≤ –∫–æ–Ω—Å–æ–ª—å –∑ —Ä—ñ–≤–Ω–µ–º `INFO`.

## Troubleshooting

### –ë–æ—Ç –Ω–µ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î
- –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ñ—Å—Ç—å `TELEGRAM_BOT_TOKEN`
- –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—è, —â–æ –±–æ—Ç –∑–∞–ø—É—â–µ–Ω–∏–π

### Webhook –Ω–µ –ø—Ä–∞—Ü—é—î
- –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å `PUBLIC_BASE_URL`
- –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—è, —â–æ `APPS_SCRIPT_WEBHOOK_SECRET` —Å–ø—ñ–≤–ø–∞–¥–∞—î –≤ `.env` —Ç–∞ Google Apps Script
- –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ª–æ–≥–∏ –Ω–∞ –Ω–∞—è–≤–Ω—ñ—Å—Ç—å –ø–æ–º–∏–ª–æ–∫

### –í–µ–±-–¥–æ–¥–∞—Ç–æ–∫ –Ω–µ –≤—ñ–¥–∫—Ä–∏–≤–∞—î—Ç—å—Å—è
- –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—è, —â–æ –ø–æ—Ä—Ç `WEB_PORT` –Ω–µ –∑–∞–π–Ω—è—Ç–∏–π
- –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —â–æ `WEB_SECRET_KEY` –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–π –≤ `.env`

### –ü–æ–º–∏–ª–∫–∏ Google Sheets API
- –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—è, —â–æ `credentials.json` —ñ—Å–Ω—É—î —Ç–∞ –≤–∞–ª—ñ–¥–Ω–∏–π
- –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —â–æ Service Account –º–∞—î –¥–æ—Å—Ç—É–ø –¥–æ —Ç–∞–±–ª–∏—Ü—ñ
- –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—è, —â–æ Google Sheets API —É–≤—ñ–º–∫–Ω–µ–Ω–∏–π –≤ –ø—Ä–æ–µ–∫—Ç—ñ

## –ë–µ–∑–ø–µ–∫–∞

- –ù—ñ–∫–æ–ª–∏ –Ω–µ –∫–æ–º—ñ—Ç—å—Ç–µ `.env` —Ñ–∞–π–ª –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ–π
- –¢—Ä–∏–º–∞–π—Ç–µ `credentials.json` –≤ —Å–µ–∫—Ä–µ—Ç—ñ
- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ —Å–∏–ª—å–Ω—ñ —Å–µ–∫—Ä–µ—Ç–Ω—ñ –∫–ª—é—á—ñ
- –û–±–º–µ–∂—Ç–µ –¥–æ—Å—Ç—É–ø –¥–æ webhook —á–µ—Ä–µ–∑ `APPS_SCRIPT_WEBHOOK_SECRET`
- –†–µ–≥—É–ª—è—Ä–Ω–æ –æ–Ω–æ–≤–ª—é–π—Ç–µ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ

## –õ—ñ—Ü–µ–Ω–∑—ñ—è

[–í–∫–∞–∂—ñ—Ç—å –≤–∞—à—É –ª—ñ—Ü–µ–Ω–∑—ñ—é]

## –ê–≤—Ç–æ—Ä

[–í–∫–∞–∂—ñ—Ç—å –∞–≤—Ç–æ—Ä–∞]
